---
title: "talk04 练习与作业"
documentclass: ctexart
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    toc_depth: 2
  word_document: default
  html_document:
    df_print: paged
knit: (
  function(inputFile, encoding) { 

    pSubTitle <- '\u674e\u7ecf\u7eac-U201912387-talk04-homework'

    rmarkdown::render( 
      input       = inputFile, 
      encoding    = encoding, 
      params      = list(sub_title = pSubTitle),      
      output_file = pSubTitle) })
---

## 练习和作业说明

将相关代码填写入以 \`\`\`{r} \`\`\` 标志的代码框中，运行并看到正确的结果；

完成后，用工具栏里的"Knit"按键生成PDF文档；

**将PDF文档**改为：`姓名-学号-talk04作业.pdf`，并提交到老师指定的平台/钉群。

## Talk04 内容回顾

## 练习与作业1：R session管理

------------------------------------------------------------------------

### **完成以下操作**

-   定义一些变量（比如 x, y , z 并赋值；内容随意）
-   从外部文件装入一些数据（可自行创建一个4行5列的数据，内容随意）
-   保存workspace 到.RData
-   列出当前工作空间内的所有变量
-   删除当前工作空间内所有变量
-   从.RData文件恢复保存的数据
-   再次列出当前工作空间内的所有变量，以确认变量已恢复
-   随机删除两个变量
-   再次列出当前工作空间内的所有变量

```{r}
## 代码写这里，并运行；
rm(list=ls())
x<-c('GEM','JJ Lin','Jay Chou')
y<-c(100,90,80)
z<-c(90,95,100)
library(readr)
a<-read.csv('data/states1.csv')[1:4,1:5]
a
save(x,y,z,a,file='talk_04_R_session_homework.RData')
ls()
rm(list=ls())
ls()
load('talk_04_R_session_homework.RData')
ls()
rm(y,z)
ls()
```

## 练习与作业2：Factor基础

------------------------------------------------------------------------

### **factor增加**

-   创建一个变量：

`x <- c("single", "married", "married", "single");`

-   为其增加 两个 levels，`single`, `married`;

-   以下操作能成功吗？

`x[3] <- "widowed"`;

-   如果不，请提供解决方案；

```{r}
## 代码写这里，并运行；
(x <- as.factor(c("single", "married", "married", "single")));
x[length(x)+1]<-'single'
x
x[length(x)+1]<-'married'
x
# 题目中`x[3] <- "widowed不能成功，应按如下方式
levels(x)<-c(levels(x),'widowed')
x
x[length(x)+1]<-'widowed'
x
```

------------------------------------------------------------------------

### **利用factor排序**

以下变量包含了几个月份，请使用`factor`，使其能按月份，而不是英文字符串排序：

`mon <- c("Mar","Nov","Mar","Aug","Sep","Jun","Nov","Nov","Oct","Jun","May","Sep","Dec","Jul","Nov");`

```{r}
## 代码写这里，并运行；
month_levels <- c(
"Jan", "Feb", "Mar", "Apr", "May", "Jun",
"Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
)
mon <- factor(c("Mar","Nov","Mar","Aug","Sep",
         "Jun","Nov","Nov","Oct","Jun",
         "May","Sep","Dec","Jul","Nov"),
         level=month_levels);
sort(mon)
```

------------------------------------------------------------------------

### **forcats的问题**

`forcats`包中的 fct_inorder, fct_infreq和 fct_inseq 函数的作用是什么？

请使用`forcats`包中的`gss_cat`数据举例说明

```{r}
## 代码写这里，并运行；
rm(list=ls())
library(forcats)
Sys.setlocale('LC_ALL','C')
# 考虑到gss_cat数据量极大，作为举例说明
# 这里一般只用某一列的前100行进行
# fct_inorder作用是，使levels按照第一次出现的顺序进行排序
# 官方文档：by the order in which they first appear.
a<-as.matrix(gss_cat[1:100,2])
a<-as.factor(a)
# 原始
a
#操作后
fct_inorder(a)
''
# 'fct_infreq作用是，使levels按照出现的频率排序'
# '官方文档：by number of observations with each level (largest first)'
b<-as.matrix(gss_cat[1:100,2])
b<-as.factor(b)
# 原始
b
# 操作后
fct_infreq(b)
''
# 'fct_inseq的作用是，使levels按照数值大小排序'
# '官方文档： by numeric value of level.'
# '此处选择一组为数字的列进行举例'
c<-as.matrix(gss_cat[1:100,'age'])
c<-as.factor(c)
# 原始
c
# 操作后
fct_inseq(c)
```

答：可以看到，进行对应操作后，内容没变，但是level发生了改变 levels会编程对应函数操作后的结果

## 练习与作业3：用 mouse genes 数据做图

------------------------------------------------------------------------

### **画图**

1.  用 readr 包中的函数读取 mouse genes 文件 （从本课程的 Github 页面下载 data/talk04/ ）
2.  选取常染色体的基因
3.  画以下两个基因长度 boxplot :

-   按染色体序号排列，比如 1, 2, 3 .... X, Y
-   按基因长度 中值 排列，从 短 -\> 长 ...

```{r}
## 代码写这里，并运行；
rm(list=ls())
library(readr)
library(dplyr)
library(ggplot2)
# '读取文件'
mouse_genes <- read_delim( file = "H:/第五学期/R-for-bioinformatics/data/talk04/mouse_genes_biomart_sep2018.txt",
                           delim = "\t", quote = "" )
mouse_genes
# '选出常染色体1-19'
tar<-as.character(c(1:19))
mouse_genes_1_19<-mouse_genes %>% filter(`Chromosome/scaffold name` %in% tar)
mouse_genes_1_19

# '开始画图，先用boxplot'
# '重新选染色体，因为包括XY'
tar<-c(1:19,'X','Y')
mouse_genes_1_19_XY<-subset(mouse_genes,`Chromosome/scaffold name` %in% tar)

# '按染色体序号排列'
name<-factor(mouse_genes_1_19_XY$`Chromosome/scaffold name`,levels = tar)
plot_name<-boxplot(`Transcript length (including UTRs and CDS)`~
                    name,
                    data=mouse_genes_1_19_XY,las=2)

# '按染色体长度中值'
name=reorder(mouse_genes_1_19_XY$`Chromosome/scaffold name`,
             mouse_genes_1_19_XY$`Transcript length (including UTRs and CDS)`,
             median)
plot_length<-boxplot(`Transcript length (including UTRs and CDS)`~
                      name,
                      data=mouse_genes_1_19_XY)
# '用ggplot画图'
plot1<-ggplot(data=mouse_genes_1_19_XY,
              aes(x=factor(mouse_genes_1_19_XY$`Chromosome/scaffold name`,levels = tar),
                  y=`Transcript length (including UTRs and CDS)`))+
      geom_boxplot()+
      coord_flip()+
      ylim(0,6000)
plot1

plot2<-ggplot(data=mouse_genes_1_19_XY,
              aes(x=reorder(`Chromosome/scaffold name`,
                            -`Transcript length (including UTRs and CDS)`,
                            median),
                  y=`Transcript length (including UTRs and CDS)`))+
      geom_boxplot()+
      coord_flip()+
      ylim(0,6000)
plot2
```
